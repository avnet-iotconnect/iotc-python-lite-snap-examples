<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>IoTConnect Manager</title>
  <link rel="stylesheet" href="../base1/cockpit.css">
  <script src="../base1/cockpit.js"></script>
  <style>
    .page-pad { padding: 16px; }
    .section { margin-bottom: 16px; }
    .hstack { display:flex; gap:.75rem; align-items:center; flex-wrap:wrap; }
    .grid-2 { display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .grid-3 { display:grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 12px; }
    .small { width: 6rem; }
    .xsmall { width: 4.5rem; }
    .full { width: 100%; }
    .muted { color: var(--pf-global--Color--200); font-size: .9em; }
    .card-pad { padding: 12px; }
    .table-wrap { max-height: 340px; overflow:auto; border:1px solid var(--pf-global--BorderColor--100); border-radius: 4px; }
    thead th { position: sticky; top: 0; background: var(--pf-global--BackgroundColor--100); z-index: 1; }
    details summary { cursor: pointer; user-select: none; }
    .divider { height:1px; background: var(--pf-global--BorderColor--100); margin: 8px 0; }
    pre#log { height: 220px; overflow:auto; border:1px solid var(--pf-global--BorderColor--100); border-radius:4px; padding:8px; background: #0b0d12; color:#d1d5db;}
  </style>
</head>
<body class="pf-c-page pf-m-redhat-font">
  <main class="pf-c-page__main page-pad">

    <h1 class="pf-c-title pf-m-2xl">IoTConnect Manager</h1>

    <!-- Controls row -->
    <div class="pf-l-grid pf-m-gutter section">

      <!-- I/O & Loop Controls -->
      <div class="pf-l-grid__item pf-m-6-col-on-lg">
        <section class="pf-c-card card-pad">
          <h2 class="pf-c-title pf-m-lg">Live Telemetry</h2>
          <div class="hstack" style="margin-top:8px">
            <button id="btn-scan" type="button" class="pf-c-button pf-m-secondary">Scan I/O</button>

            <label class="pf-c-form__label">
              <span class="pf-c-form__label-text">Interval (sec)</span>
              <input id="interval" class="pf-c-form-control small" type="number" min="2" value="10" inputmode="decimal">
            </label>

            <button id="btn-start" type="button" class="pf-c-button pf-m-primary">Start</button>
            <button id="btn-stop"  type="button" class="pf-c-button pf-m-secondary">Stop</button>
            <span class="muted">Checked rows will be sent each interval.</span>
          </div>

          <div class="divider"></div>

          <details>
            <summary><strong>Modbus AI (ED‑589)</strong> <span class="muted">(optional)</span></summary>
            <div class="grid-3" style="margin-top:10px">
              <label class="pf-c-form__label">
                <span class="pf-c-form__label-text">Device IP</span>
                <input id="mb-ip" class="pf-c-form-control" placeholder="e.g. 192.168.0.100">
              </label>
              <label class="pf-c-form__label">
                <span class="pf-c-form__label-text">Unit</span>
                <input id="mb-unit" class="pf-c-form-control xsmall" value="1" inputmode="numeric">
              </label>
              <label class="pf-c-form__label">
                <span class="pf-c-form__label-text">Start Reg</span>
                <input id="mb-start" class="pf-c-form-control small" value="30001" inputmode="numeric">
              </label>
              <label class="pf-c-form__label">
                <span class="pf-c-form__label-text">Count</span>
                <input id="mb-count" class="pf-c-form-control xsmall" value="8" inputmode="numeric">
              </label>
              <label class="pf-c-form__label">
                <span class="pf-c-form__label-text">Scale</span>
                <input id="mb-scale" class="pf-c-form-control xsmall" value="1" inputmode="decimal">
              </label>
              <label class="pf-c-form__label">
                <span class="pf-c-form__label-text">Offset</span>
                <input id="mb-offset" class="pf-c-form-control xsmall" value="0" inputmode="decimal">
              </label>
            </div>
            <div class="hstack" style="margin-top:10px">
              <button id="btn-scan-ai" class="pf-c-button pf-m-secondary">Scan Modbus AI</button>
              <span class="muted">Creates <code>ai0..aiN</code> rows; values refresh every tick.</span>
            </div>
          </details>
        </section>
      </div>

      <!-- Template & Advanced -->
      <div class="pf-l-grid__item pf-m-6-col-on-lg">
        <section class="pf-c-card card-pad">
          <h2 class="pf-c-title pf-m-lg">Device Template</h2>
          <div class="grid-2" style="margin-top:8px">
            <label class="pf-c-form__label">
              <span class="pf-c-form__label-text">Template Code</span>
              <input id="tmpl-code" class="pf-c-form-control" placeholder="e.g. bb400_iotc">
            </label>
            <label class="pf-c-form__label">
              <span class="pf-c-form__label-text">Template Name</span>
              <input id="tmpl-name" class="pf-c-form-control" placeholder="e.g. BB‑400 IOTC">
            </label>
          </div>
          <div class="hstack" style="margin-top:10px">
            <button id="btn-gen-template" class="pf-c-button pf-m-secondary">Generate Template</button>
            <span class="muted">Uses checked rows & their aliases; infers types.</span>
          </div>

          <div class="divider"></div>

          <details>
            <summary><strong>Advanced</strong> <span class="muted">(debug / manual test)</span></summary>
            <div class="hstack" style="margin-top:10px">
              <button id="btn-test" type="button" class="pf-c-button pf-m-secondary">Test Send</button>
              <span class="muted">Sends a fixed envelope to the IoTConnect socket.</span>
            </div>
          </details>
        </section>
      </div>
    </div>

    <!-- Signals table -->
    <section class="pf-c-card card-pad section">
      <h2 class="pf-c-title pf-m-lg">Signals</h2>
      <div class="table-wrap" style="margin-top:8px">
        <table class="pf-c-table pf-m-grid-md" role="grid" style="width:100%">
          <thead>
            <tr>
              <th style="width:90px">Select</th>
              <th style="min-width:200px">Source Key</th>
              <th>Alias (sent to cloud)</th>
              <th style="min-width:160px">Sample Value</th>
            </tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>
      </div>
    </section>

    <!-- Log -->
    <section class="pf-c-card card-pad">
      <h2 class="pf-c-title pf-m-lg">Log</h2>
      <pre id="log" aria-live="polite"></pre>
    </section>

  </main>

  <!-- bump the querystring when you update manager.js -->
  <script defer src="manager.js?v=7"></script>
</body>
</html>
